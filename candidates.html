<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Candidates | HMJ-Global</title>
  <script src="js/hmj-identity.js"></script>
  <script defer src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const identity = window.hmjConfigureIdentity?.() || window.netlifyIdentity || null;
      if (!identity) return;

      identity.on('login', () => {
        const dest = sessionStorage.getItem('afterLogin') || '/timesheets.html';
        sessionStorage.removeItem('afterLogin');
        window.location.href = dest;
      });
      identity.on('logout', () => {
        window.location.href = '/';
      });
    });
  </script>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    /* ========= Vars / Theme ========= */
    :root{ --ink:#1A1A2E; --accent:#3A66B3; --muted:#6b7280; }

    /* ========= Header / Nav (matching other upgraded pages) ========= */
    .hmj-header{position:sticky;top:0;z-index:1000;background:#0f1322;color:#fff;border-bottom:1px solid rgba(255,255,255,.06)}
    .hmj-nav{max-width:1200px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:12px}
    .hmj-logo img{height:40px;display:block}

    .hmj-menu{list-style:none;display:flex;gap:8px;margin-left:auto;padding:0}
    .hmj-menu a{
      display:inline-block;padding:10px 12px;border-radius:10px;font-weight:700;
      color:#eaf0ff;text-decoration:none;transition:background .2s,color .2s;
    }
    .hmj-menu a:hover{background:rgba(255,255,255,.10);color:#fff}
    .hmj-menu a[aria-current="page"]{background:rgba(58,102,179,.20);color:#dfe8ff;border:1px solid rgba(58,102,179,.45)}

    .hmj-burger{display:none;margin-left:auto;border:0;background:transparent;width:42px;height:42px;border-radius:10px;cursor:pointer}
    .hmj-burger span{display:block;height:2px;background:#eaf0ff;margin:7px 8px;border-radius:2px;transition:transform .2s,opacity .2s}

    .hmj-scrim{position:fixed;inset:0;background:rgba(0,0,0,.35)}
    @media (max-width:900px){
      .hmj-burger{display:inline-block}
      .hmj-menu{
        position:fixed;right:12px;left:12px;top:64px;
        background:#0f1322;border:1px solid rgba(255,255,255,.12);border-radius:14px;
        box-shadow:0 16px 40px rgba(0,0,0,.35);
        display:grid;gap:6px;padding:0;max-height:0;overflow:hidden;
        transition:max-height .28s ease, padding .2s ease;
      }
      .hmj-menu.open{max-height:70vh;padding:10px}
      .hmj-menu a{padding:14px 12px;width:100%}
      .hmj-scrim[hidden]{display:none}
    }
    .hmj-burger[aria-expanded="true"] span:nth-child(1){transform:translateY(9px) rotate(45deg)}
    .hmj-burger[aria-expanded="true"] span:nth-child(2){opacity:0}
    .hmj-burger[aria-expanded="true"] span:nth-child(3){transform:translateY(-9px) rotate(-45deg)}

    .cv-form :required:invalid{ border-color:#e57373; }
    .cv-form :required:invalid:focus{ outline:2px solid #e57373; }



    /* ========= Hero (scanlines + electric line) ========= */
    .hero-cand{
      min-height:42vh; display:grid; place-items:center; padding:120px 20px 100px;
      text-align:center; color:#fff; position:relative;
      background:url('images/hero.jpg') center/cover no-repeat;
    }
    .hero-cand::before{ content:""; position:absolute; inset:0;
      background:linear-gradient(180deg,rgba(26,26,46,.78),rgba(26,26,46,.55)); }
    .hero-cand::after{
      content:""; position:absolute; inset:0; pointer-events:none; opacity:.18;
      background:
        repeating-linear-gradient(90deg, rgba(255,255,255,.12) 0 1px, transparent 1px 8px),
        repeating-linear-gradient(0deg, rgba(255,255,255,.07) 0 1px, transparent 1px 10px);
      transform:translateX(0);
      animation:scanMove 18s linear infinite;
    }
    @keyframes scanMove { to { transform:translateX(16px); } }
    .hero-cand>*{ position:relative; z-index:1; }
    .hero-cand h1{ margin:0 0 8px; font-size:clamp(28px,4vw,42px); line-height:1.15; }
    .hero-cand p{ margin:0; opacity:.95; }

    .power-underline{width:min(88vw,740px); height:14px; margin:12px auto 0; opacity:.9}
    .power-underline path{stroke:#5f86ff; stroke-width:2; fill:none; stroke-linecap:round;
      stroke-dasharray:6 8; animation:flow 2.8s linear infinite;}
    @keyframes flow { to { stroke-dashoffset:-280; } }

    /* ========= Layout / Cards / Grids ========= */
    .section{ padding:36px 20px; }
    .wrap{ max-width:1100px; margin:0 auto; }
    .grid{ display:grid; gap:18px; }
    .grid-2{ grid-template-columns:repeat(2,minmax(0,1fr)); }
    .grid-3{ grid-template-columns:repeat(3,minmax(0,1fr)); }
    @media (max-width:880px){ .grid-2,.grid-3{ grid-template-columns:1fr; } }

    .card{ background:#fff; border:1px solid rgba(26,26,46,.14); border-radius:16px; padding:18px 20px;
      box-shadow:0 6px 18px rgba(0,0,0,.08); }
    .soft{ background:linear-gradient(180deg,rgba(58,102,179,.06),transparent 55%), #fff; }

    .kpi{ text-align:center; padding:20px 14px; }
    .kpi h3{ margin:0; font-size:26px; }
    .kpi p{ margin:6px 0 0; color:#555; }

    /* ========= Form styling (preserved) ========= */
    .cv-form label{ font-weight:600; display:block; margin:10px 0 6px; }
    .cv-form input[type="text"], .cv-form input[type="email"], .cv-form input[type="tel"],
    .cv-form input[type="number"], .cv-form select, .cv-form textarea{
      width:100%; padding:10px; border:1px solid #cfd5f7; border-radius:10px; font:inherit;
    }
    .small{ font-size:.9rem; color:#6b7280; }

    .tag-input{ display:flex; gap:8px; flex-wrap:wrap; border:1px solid #cfd5f7; border-radius:10px; padding:10px; }
    .tag-chip{ background:rgba(58,102,179,.12); color:#3A66B3; border:1px solid rgba(58,102,179,.25);
      padding:4px 8px; border-radius:999px; font-weight:600; display:flex; gap:6px; align-items:center; }
    .tag-chip button{ border:0; background:transparent; cursor:pointer; font-weight:700; }

    .meter-wrap{ height:10px; background:#eef1ff; border-radius:999px; overflow:hidden; }
    .meter{ height:100%; width:0%; background:#3A66B3; transition:width .25s ease; }

    .timeline{ position:relative; }
    .timeline::before{ content:""; position:absolute; left:18px; top:0; bottom:0; width:2px; background:#e5e9ff; }
    .step{ position:relative; padding-left:48px; margin-bottom:16px; }
    .step::before{ content:""; position:absolute; left:9px; top:2px; width:18px; height:18px; border-radius:50%;
      background:#3A66B3; box-shadow:0 0 0 4px rgba(58,102,179,.18); }

    details{ background:#fff; border:1px solid rgba(26,26,46,.14); border-radius:12px; padding:12px 14px; }
    details + details{ margin-top:10px; }
    details summary{ cursor:pointer; font-weight:700; }

    .rtw-wrap{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px; }
    @media (max-width:620px){ .rtw-wrap{ grid-template-columns:1fr; } }
    .rtw-item{ display:flex; align-items:center; gap:8px; border:1px solid #cfd5f7; border-radius:10px; padding:10px; background:#fff; }
    .rtw-item input{ width:18px; height:18px; }

    /* ========= Sticky Preview Dock (desktop) ========= */
    .preview-dock{
      position:fixed; top:88px; right:18px; width:340px; max-height:68vh; overflow:auto;
      background:#0f1322; color:#eaf0ff; border:1px solid rgba(255,255,255,.12); border-radius:14px;
      box-shadow:0 14px 38px rgba(0,0,0,.35); padding:12px; z-index:900;
      display:none; /* hidden by default on small screens */
    }
    .preview-dock h3{ margin:0 0 6px; font-size:16px; }
    .preview-dock .preview-inner{ background:#111731; border:1px dashed rgba(255,255,255,.18); border-radius:12px; padding:12px; }
    .preview-dock .hint{ font-size:.82rem; opacity:.8; margin-top:8px; }

    /* show dock on wide screens only */
    @media (min-width:1200px){
      .preview-dock{ display:block; }
      /* add a little breathing room to page so dock doesn't overlap content */
      body{ padding-right:370px; }
    }

    /* Inline preview (shown on small screens, above form) */
    .inline-preview{ display:block; }
    @media (min-width:1200px){ .inline-preview{ display:none; } }

    /* ========= CTA / Footer ========= */
    .cta{ text-align:center; padding:48px 20px; background:
      radial-gradient(1200px 300px at 50% -50px, rgba(58,102,179,.22), transparent 60%),
      #0f1322; color:#eaf0ff; }
    footer{ text-align:center; padding:28px 16px; background:#0f1322; color:#cfd7ff; border-top:1px solid rgba(255,255,255,.06) }

    /* ========= Reveal-on-scroll ========= */
    .reveal{opacity:0; transform:translateY(12px); transition:opacity .5s ease, transform .5s ease}
    .reveal.revealed{opacity:1; transform:none}

    /* ========= Toast ========= */
    .toast{
      position:fixed; bottom:18px; left:18px; background:#1A1A2E; color:#fff;
      padding:8px 12px; border-radius:10px; box-shadow:0 8px 18px rgba(0,0,0,.22);
      opacity:0; transform:translateY(8px); transition:opacity .2s ease, transform .2s ease; z-index:9999; font-size:.9rem;
    }
    .toast.show{ opacity:1; transform:translateY(0); }
  </style>
</head>

<body>
  <!-- ===== Header / Navbar (Home, Candidates, Clients, Jobs) ===== -->
  <header class="hmj-header">
    <nav class="hmj-nav" aria-label="Main">
      <a class="hmj-logo" href="index.html">
        <img src="images/logo.png" alt="HMJ-Global Logo" />
      </a>

      <button class="hmj-burger" aria-label="Open menu" aria-expanded="false" aria-controls="hmj-menu">
        <span></span><span></span><span></span>
      </button>

      <ul id="hmj-menu" class="hmj-menu">
        <li><a href="index.html" data-page="index">Home</a></li>
        <li><a href="about.html" data-page="about">About</a></li>
        <li><a href="clients.html" data-page="clients">Clients</a></li>
        <li><a href="candidates.html" data-page="candidates">Candidates</a></li>
        <li><a href="jobs.html" data-page="jobs">Jobs</a></li>
        <li><a href="https://www.hmj-finance.com" target="_blank" rel="noopener">Accounting</a></li>
        <li><a href="/timesheets.html" id="nav-timesheets" aria-disabled="true">Timesheets</a></li>
        <li><a href="/admin/" id="nav-admin" class="requires-admin" style="display:none" aria-disabled="true">Admin Dashboard</a></li>
      </ul>
      <div class="hmj-scrim" hidden></div>
    </nav>
  </header>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const admin = document.getElementById('nav-admin');
      const timesheets = document.getElementById('nav-timesheets');

      if (!admin && !timesheets) {
        return;
      }

      const rolesOf = (user) => Array.isArray(user?.app_metadata?.roles)
        ? user.app_metadata.roles
        : Array.isArray(user?.roles)
          ? user.roles
          : [];

      function updateTimesheets(user) {
        if (!timesheets) return;
        if (user) {
          timesheets.href = '/timesheets.html';
          timesheets.removeAttribute('aria-disabled');
          timesheets.title = 'Open timesheets';
        } else {
          timesheets.href = '#';
          timesheets.setAttribute('aria-disabled', 'true');
          timesheets.title = 'Sign in to access timesheets';
        }
      }

      function updateAdmin(user) {
        if (!admin) return;
        const isAdmin = rolesOf(user).includes('admin');
        if (isAdmin) {
          admin.style.display = 'inline-block';
          admin.href = '/admin/';
          admin.removeAttribute('aria-disabled');
          admin.classList.remove('requires-admin');
          admin.textContent = 'Admin Dashboard';
          admin.title = 'Open the admin dashboard';
        } else {
          admin.style.display = 'none';
          admin.href = '/admin/';
          admin.setAttribute('aria-disabled', 'true');
          admin.classList.add('requires-admin');
          admin.textContent = 'Admin Dashboard';
          admin.title = 'Admin access only';
        }
      }

      const renderFor = (user) => {
        updateTimesheets(user);
        updateAdmin(user);
      };

      function requireLogin(event, destination) {
        if (event) event.preventDefault();
        const identity = window.hmjConfigureIdentity?.() || window.netlifyIdentity || null;
        if (!identity || typeof identity.open !== 'function') {
          if (destination) {
            window.location.href = destination;
          }
          return;
        }
        if (destination) {
          sessionStorage.setItem('afterLogin', destination);
        }
        identity?.open?.('login');
      }

      function attachIdentity(identity) {
        const id = identity || window.hmjConfigureIdentity?.() || window.netlifyIdentity || null;
        if (!id || typeof id.on !== 'function') {
          return null;
        }
        if (!id.__hmjNavListeners) {
          id.__hmjNavListeners = true;
          id.on('init', (user) => renderFor(user));
          id.on('login', (user) => renderFor(user));
          id.on('logout', () => renderFor(null));
        }
        return id;
      }

      timesheets?.addEventListener('click', (event) => {
        const identity = window.hmjConfigureIdentity?.() || window.netlifyIdentity || null;
        const user = identity?.currentUser?.();
        if (user) return;
        requireLogin(event, '/timesheets.html');
      });

      admin?.addEventListener('click', (event) => {
        const identity = window.hmjConfigureIdentity?.() || window.netlifyIdentity || null;
        const user = identity?.currentUser?.();
        if (user) return;
        requireLogin(event, '/admin/');
      });

      document.addEventListener('hmj:identity-change', (event) => {
        const identity = attachIdentity(event?.detail?.identity || null);
        if (!identity) {
          renderFor(null);
          return;
        }
        try {
          renderFor(identity.currentUser?.() || null);
        } catch {
          renderFor(null);
        }
      });

      const initial = attachIdentity(window.hmjConfigureIdentity?.() || window.netlifyIdentity || null);
      if (initial) {
        try {
          renderFor(initial.currentUser?.() || null);
        } catch {
          renderFor(null);
        }
      } else {
        renderFor(null);
      }
    });
  </script>

<!-- ===== Hero ===== -->
  <section class="hero-cand">
    <div>
      <h1>Candidate Registration</h1>

      <!-- single electric line under heading -->
      <svg class="power-underline" viewBox="0 0 800 14" role="img" aria-label="animated power line">
        <path d="M2 7 C 100 7, 140 7, 180 7
                 C 220 7, 240 2, 260 7
                 C 280 12, 300 7, 340 7
                 C 380 7, 420 7, 460 7
                 C 500 7, 520 2, 540 7
                 C 560 12, 580 7, 620 7
                 C 660 7, 720 7, 798 7" />
      </svg>

      <p>Your next mission-critical role across the UK & Europe — with rotations, weekly pay and real support.</p>
    </div>
  </section>

  <!-- ===== Value props ===== -->
  <section class="section">
    <div class="wrap grid grid-3">
      <div class="card kpi soft reveal"><h3>48 hrs</h3><p>Typical time to first roles</p></div>
      <div class="card kpi soft reveal"><h3>Fair Pay</h3><p>Transparent rates & weekly payroll</p></div>
      <div class="card kpi soft reveal"><h3>EU Mobility</h3><p>Cross-border support & compliance</p></div>
    </div>
  </section>

  <!-- ===== Intro ===== -->
  <section class="section">
    <div class="wrap">
      <div class="card reveal">
        <h2 style="margin:0 0 10px;">Your Next Opportunity</h2>
        <p style="margin:0; line-height:1.8;">
          HMJ-Global specialises in mission-critical environments: data centres, substations, pharma cleanrooms
          and critical facilities. We line up work that matches your skills and preferences, help with onboarding and
          relocation where needed, and keep payroll simple: <em>weekly, on time, every time</em>. We believe in fair pay,
          clear communication and safe sites—because the best projects are built on trust.
        </p>
      </div>
    </div>
  </section>

  <!-- ===== Sticky Preview Dock (desktop) ===== -->
  <aside class="preview-dock" aria-live="polite" aria-label="Profile preview">
    <h3>Live Profile Preview</h3>
    <div id="previewDock" class="preview-inner">
      <em>Start completing the form to see your one-page profile preview…</em>
    </div>
    <p class="hint">This preview is local to your browser and not sent anywhere.</p>
  </aside>

  <!-- ===== Inline preview (mobile/tablet) ===== -->
  <section class="section inline-preview" style="background:#f7f8ff;">
    <div class="wrap">
      <div class="card soft">
        <h2 style="margin-top:0;">Your Profile Preview</h2>
        <div id="previewInline" class="card" style="padding:14px; border-style:dashed;">
          <em>Start completing the form to see your one-page profile preview…</em>
        </div>
        <p class="small" style="margin-top:10px;">This preview is for your reference only and is not sent anywhere.</p>
      </div>
    </div>
  </section>

  <!-- ===== Application Form (full width) ===== -->
  <section class="section" style="background:#f7f8ff;">
    <div class="wrap">
      <div class="card">
        <h2 style="margin-top:0;">Submit Your Profile</h2>
        <p class="small">Complete the form and attach your CV. We’ll be in touch with relevant roles (usually within 48 hrs).</p>

        <form name="candidate-cv" action="/" method="POST" data-netlify="true" netlify-honeypot="bot-field"
              enctype="multipart/form-data" class="cv-form" id="candForm">
          <input type="hidden" name="form-name" value="candidate-cv" />
          <!-- Honeypot -->
          <p style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">
            <label>Don’t fill this out if you’re human: <input name="bot-field"></label>
          </p>
          <!-- Hidden field to collect tags + page URL + RTW selections -->
          <input type="hidden" name="skills" id="skillsHidden" />
          <input type="hidden" name="page_url" id="pageUrlHidden" />
          <input type="hidden" name="right_to_work" id="rtwHidden" />

          <label for="fname">First name *</label>
          <input id="fname" name="first_name" type="text" required>

          <label for="lname">Surname *</label>
          <input id="lname" name="surname" type="text" required>

          <label for="email">Email *</label>
          <input id="email" name="email" type="email" required>

          <label for="phone">Contact telephone (incl. country code) *</label>
          <input id="phone" name="phone" type="tel" required
                 pattern="^\+?[0-9\s\-()]{7,}$" title="Include country code, e.g. +353 85 123 4567">

          <label for="location">Current location (City, Country) *</label>
          <input id="location" name="location" type="text" required>

          <label for="discipline">Discipline *</label>
          <select id="discipline" name="discipline" required>
            <option value="">Select…</option>
            <option>CSA</option>
            <option>Electrical (MEP)</option>
            <option>Mechanical (MEP)</option>
            <option>Commissioning</option>
            <option>Security & Cabling</option>
            <option>HV / Substations</option>
            <option>Pharma / CQV</option>
            <option>Critical Facilities</option>
          </select>

          <label for="role">Role of interest</label>
          <input id="role" name="role" type="text" placeholder="e.g. MEP Commissioning Manager" required>
          <p class="small" id="roleTip" style="margin-top:6px;"></p>

          <label for="salary">Salary / day rate expectation (numeric)</label>
          <input id="salary" name="salary_expectation" type="number" min="0" step="100">

          <label for="notice">Notice period</label>
          <input id="notice" name="notice_period" type="text" placeholder="e.g. 2 weeks, immediate" required>


          <label>Right to work — regions you’re authorised to work in * <span class="small">(you can select more than one)</span></label>
          <div class="rtw-wrap" id="rtwGroup" aria-describedby="rtwHelp">
            <label class="rtw-item"><input type="checkbox" value="United Kingdom"> United Kingdom</label>
            <label class="rtw-item"><input type="checkbox" value="European Union / EEA"> European Union / EEA</label>
            <label class="rtw-item"><input type="checkbox" value="United Arab Emirates (UAE)"> United Arab Emirates (UAE)</label>
            <label class="rtw-item"><input type="checkbox" value="Asia–Pacific"> Asia–Pacific</label>
            <label class="rtw-item"><input type="checkbox" value="North America"> North America</label>
            <label class="rtw-item"><input type="checkbox" value="Latin America (incl. Central America)"> Latin America (incl. Central America)</label>
            <label class="rtw-item"><input type="checkbox" value="Other / Please specify in notes"> Other / Please specify in notes</label>
          </div>
          <p id="rtwHelp" class="small" style="margin-top:6px;">Tip: choose all that apply (dual nationality welcome).</p>

          <label for="reloc">Open to relocation *</label>
          <select id="reloc" name="relocation" required>
            <option value="" selected disabled>Select…</option>
            <option>Maybe</option>
            <option>Yes</option>
            <option>No</option>
          </select>


          <label for="linkedin">LinkedIn profile</label>
          <input id="linkedin" name="linkedin" type="text" placeholder="https://…">

          <label>Key skills (add & enter)</label>
          <div class="tag-input" id="tagBox">
            <input id="tagInput" type="text" placeholder="e.g. IST, BMS, 33kV, Cleanrooms" style="border:0; outline:none; flex:1;">
          </div>
          <p class="small" id="skillHints" style="margin-top:6px;"></p>

          <label for="message">Message / cover note</label>
          <textarea id="message" name="message" rows="5" placeholder="Tell us what you’re looking for, preferred locations, rotations…"></textarea>

          <label for="cv">Attach CV (PDF/DOC/DOCX) *</label>
          <input id="cv" name="attachment" type="file" accept=".pdf,.doc,.docx" required>

          <div class="small" style="margin:8px 0;">Profile strength</div>
          <div class="meter-wrap"><div class="meter" id="meter"></div></div>

          <div style="margin-top:14px;">
            <label style="display:flex; align-items:center; gap:8px;">
              <input type="checkbox" required> I consent to HMJ-Global processing my data to find suitable roles.
            </label>
          </div>

          <button id="submitBtn" type="submit" class="btn-primary" style="margin-top:12px;">Send Profile</button>
        </form>

        <p class="small" style="margin-top:10px;">
          We respect your privacy. We never disclose client names in public listings and only share your details with your permission.
        </p>
      </div>
    </div>
  </section>

  <!-- ===== What to Expect (timeline) ===== -->
  <section class="section">
    <div class="wrap">
      <h2>What to Expect</h2>
      <div class="card timeline reveal">
        <div class="step"><h3 style="margin:0 0 4px;">1. Share Your Profile</h3><p>Send your CV and preferences. We match you to roles that fit your skills and goals.</p></div>
        <div class="step"><h3 style="margin:0 0 4px;">2. Roles in 48 Hours</h3><p>We’ll line up opportunities and brief you on scope, site culture and pay.</p></div>
        <div class="step"><h3 style="margin:0 0 4px;">3. Interviews & Feedback</h3><p>We manage the process, keep communication clear and prep you for success.</p></div>
        <div class="step"><h3 style="margin:0 0 4px;">4. Mobilise & Payroll</h3><p>Documentation, inductions and weekly pay—so your start is clean and stress-free.</p></div>
      </div>
    </div>
  </section>

  <!-- ===== FAQs ===== -->
  <section class="section" style="background:#f7f8ff;">
    <div class="wrap">
      <h2>FAQs</h2>
      <details class="reveal">
        <summary>Do you place across Europe?</summary>
        <p>Yes—UK, Ireland, Nordics, Benelux, Germany and Southern Europe. We support compliant cross-border moves.</p>
      </details>
      <details class="reveal">
        <summary>How often is payroll?</summary>
        <p>Weekly for contractors. We’re transparent on rates and payment timelines.</p>
      </details>
      <details class="reveal">
        <summary>What types of roles?</summary>
        <p>CSA, Electrical/Mechanical (MEP), Commissioning, Security & Cabling, HV/Substations, Pharma/CQV and Critical Facilities.</p>
      </details>
    </div>
  </section>

  <!-- ===== CTA ===== -->
  <section class="cta">
    <h2>Ready to find your next role?</h2>
    <p>Submit your profile or browse live jobs now.</p>
    <a href="jobs.html" class="btn-secondary">Browse Jobs</a>
    <a href="#candForm" class="btn-primary">Send Profile</a>
  </section>

  <!-- ===== Footer ===== -->
  <footer>
    <p>&copy; 2025 HMJ-Global Ltd. All rights reserved.</p>
    <br><br><br>
    <p>HMJ-Global is a trading name of HMJ-Global Ltd, registered in England & Wales, company number 16029938.</p>
    <p>Registered office: 905 Lightbox Blue, Media City, UK.</p>
  </footer>

  <!-- ===== Autosave toast ===== -->
  <div id="autosaveToast" class="toast" role="status" aria-live="polite">Draft restored ✔</div>

  <!-- ===== Scripts ===== -->
  <script>
    (function(){
      /* ---------- Nav ---------- */
      const burger = document.querySelector('.hmj-burger');
      const menu   = document.getElementById('hmj-menu');
      const scrim  = document.querySelector('.hmj-scrim');

      // highlight current page
      const currentSegment = (location.pathname.replace(/\/+$/, '').split('/').pop() || 'candidates.html').toLowerCase();
      const currentNormalized = currentSegment.replace(/^\//, '');
      menu.querySelectorAll('a[href]').forEach(a=>{
        const href = (a.getAttribute('href') || '').trim();
        if (!href || href.includes('://')) return;
        const target = (href.split('#')[0] || '').replace(/^\//, '').toLowerCase() || 'index.html';
        if(target === currentNormalized){ a.setAttribute('aria-current','page'); }
      });

      function openMenu(open){
        burger.setAttribute('aria-expanded', String(open));
        menu.classList.toggle('open', open);
        scrim.hidden = !open;
        document.documentElement.style.overflow = open ? 'hidden' : '';
      }
      burger.addEventListener('click', ()=>openMenu(burger.getAttribute('aria-expanded') !== 'true'));
      scrim.addEventListener('click', ()=>openMenu(false));
      // Close the panel *after* the browser handles link navigation.
      // Using rAF prevents rare iOS/Safari cases where DOM changes interrupt the click.
      menu.addEventListener('click', (e) => {
        const link = e.target.closest('a[href]');
        if(!link) return;
        requestAnimationFrame(() => openMenu(false));
      });

      document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') openMenu(false); });

      /* ---------- Scroll reveal ---------- */
      const toReveal = document.querySelectorAll('.reveal');
      if('IntersectionObserver' in window){
        const io = new IntersectionObserver((entries)=>{
          entries.forEach(ent=>{
            if(ent.isIntersecting){
              ent.target.classList.add('revealed');
              io.unobserve(ent.target);
            }
          });
        },{threshold:0.14});
        toReveal.forEach(el=>io.observe(el));
      } else {
        toReveal.forEach(el=>el.classList.add('revealed'));
      }

      /* ---------- Form utilities (kept from your version; enhanced) ---------- */
      // Auto-fill "role of interest" if ?role= is present
      const urlParams = new URLSearchParams(window.location.search);
      const roleParam = urlParams.get('role');
      if(roleParam){ document.getElementById('role').value = decodeURIComponent(roleParam.replace(/\+/g,' ')); }

      // Skills tags
      const tagInput = document.getElementById('tagInput');
      const tagBox   = document.getElementById('tagBox');
      const skillsHidden = document.getElementById('skillsHidden');
      const skillHints = document.getElementById('skillHints');
      const SUGGESTIONS = ['IST','SAT','BMS','EPMS','Black Start','LV','MV','HV','33kV','66kV','FAT','IQ/OQ/PQ','GMP','Cleanrooms','Commissioning','CSA','MEP','QA/QC','SAP','Cable Jointing','Substations'];
      let tags = [];
      const renderTags = () => {
        [...tagBox.querySelectorAll('.tag-chip')].forEach(n=>n.remove());
        tags.forEach((t,i)=>{
          const chip=document.createElement('span');
          chip.className='tag-chip';
          chip.innerHTML = t + ' <button type="button" aria-label="remove">×</button>';
          chip.querySelector('button').onclick=()=>{ tags.splice(i,1); renderTags(); syncHidden(); refresh(); };
          tagBox.insertBefore(chip, tagInput);
        });
        const q = tagInput.value.trim().toLowerCase();
        const disc = document.getElementById('discipline').value;
        const discBias = {
          'Commissioning':['IST','SAT','FAT','BMS','EPMS','Black Start','QA/QC'],
          'Electrical (MEP)':['LV','MV','HV','33kV','66kV','Cable Jointing','SAP'],
          'Mechanical (MEP)':['MEP','Commissioning','IQ/OQ/PQ','GMP','Cleanrooms'],
          'HV / Substations':['SAP','Substations','HV','66kV','33kV','Cable Jointing'],
          'Pharma / CQV':['CQV','GMP','IQ/OQ/PQ','Cleanrooms']
        }[disc] || [];
        let pool = [...new Set([...discBias, ...SUGGESTIONS])].filter(s=>!tags.includes(s));
        if(q) pool = pool.filter(s=>s.toLowerCase().includes(q));
        skillHints.innerHTML = pool.slice(0,6).map(s=>`<button type="button" data-skill="${s}" style="margin:4px 6px 0 0;border:1px solid #cfd5f7;border-radius:999px;padding:4px 8px;background:#fff;cursor:pointer;">+ ${s}</button>`).join('');
        skillHints.querySelectorAll('button').forEach(b=>b.onclick=()=>{ const v=b.dataset.skill; if(!tags.includes(v)){ tags.push(v); renderTags(); syncHidden(); refresh(); }});
      };
      const syncHidden = ()=> { skillsHidden.value = tags.join(', '); };
      tagInput.addEventListener('input', renderTags);
      tagInput.addEventListener('keydown', (e)=>{
        if(e.key==='Enter' || e.key===','){
          e.preventDefault();
          const v = tagInput.value.trim().replace(/,$/,'');
          if(v && !tags.includes(v)){ tags.push(v); renderTags(); syncHidden(); refresh(); }
          tagInput.value='';
        } else if(e.key==='Backspace' && !tagInput.value && tags.length){
          tags.pop(); renderTags(); syncHidden(); refresh();
        }
      });

      // RTW
      const rtwGroup = document.getElementById('rtwGroup');
      const rtwHidden = document.getElementById('rtwHidden');
      const getRTW = () => [...rtwGroup.querySelectorAll('input[type="checkbox"]:checked')].map(i=>i.value);
      rtwGroup.addEventListener('change', ()=>{ rtwHidden.value = getRTW().join(', '); refresh(); });

      // Role tips
      const roleTip = document.getElementById('roleTip');
      const tipMap = {
        'Commissioning':'Try titles like “MEP Commissioning Manager”, “Lead IST Engineer”, “BMS Commissioning Engineer”.',
        'Electrical (MEP)':'Popular: “Electrical Supervisor”, “MEP Package Manager”, “AP/AE Electrical Engineer”.',
        'Mechanical (MEP)':'Popular: “Mechanical Supervisor”, “MEP Coordinator”, “Piping/Utilities Engineer”.',
        'HV / Substations':'Popular: “SAP (HV)”, “Protection Engineer”, “Cable Jointer”, “Substation Supervisor”.',
        'Security & Cabling':'Popular: “CCTV/Access Control Engineer”, “Structured Cabling Engineer”.',
        'Pharma / CQV':'Popular: “CQV Engineer”, “Validation Engineer”, “Process Utilities Engineer”.',
        'CSA':'Popular: “CSA Package Manager”, “Site Engineer (CSA)”, “Planner (CSA)”.'
      };
      const disciplineEl = document.getElementById('discipline');
      disciplineEl.addEventListener('change', ()=>{ roleTip.textContent = tipMap[disciplineEl.value] || ''; renderTags(); });

      // Strength meter + preview
      const meter = document.getElementById('meter');
      const previewDock = document.getElementById('previewDock');
      const previewInline = document.getElementById('previewInline');

      const fields = ['fname','lname','email','phone','location','discipline','role','notice','reloc','cv'];
      const P = (id) => (document.getElementById(id)?.value || '').trim();

      const refresh = () => {
        let score = 0;
        fields.forEach(id=>{
          const el = document.getElementById(id) || document.querySelector(`[name="${id}"]`);
          if(!el) return;
          if(el.type==='file'){ if(el.files && el.files.length) score++; }
          else if(el.value.trim()) score++;
        });
        if(getRTW().length) score++;
        if(tags.length) score++;
        const max = fields.length + 2;
        meter.style.width = Math.round((score/max)*100) + '%';

        const rtwTxt = getRTW().join(', ') || '—';
        const lines = [
          `<strong>${P('fname')} ${P('lname')}</strong> – ${P('discipline') || 'Discipline'} candidate`,
          `<strong>Location:</strong> ${P('location') || '—'} | <strong>Right to work:</strong> ${rtwTxt}`,
          `<strong>Role interest:</strong> ${P('role') || '—'} | <strong>Salary/day rate:</strong> ${P('salary') || '—'}`,
          `<strong>Notice:</strong> ${P('notice') || '—'} | <strong>Relocation:</strong> ${document.getElementById('reloc').value || '—'}`,
          `<strong>LinkedIn:</strong> ${P('linkedin') || '—'}`,
          tags.length ? `<strong>Key skills:</strong> ${tags.join(', ')}` : '',
          P('message') ? `<strong>Notes:</strong> ${P('message')}` : ''
        ].filter(Boolean).map(l=>`<p style="margin:6px 0;">${l}</p>`).join('') || '<em>Start completing the form to see your one-page profile preview…</em>';

        previewDock.innerHTML = lines;
        previewInline.innerHTML = lines;
      };

      document.getElementById('candForm').addEventListener('input', refresh);
      document.getElementById('cv').addEventListener('change', refresh);
      renderTags(); // initial hints

      // Autosave / restore
      const STORE_KEY='hmj_candidate_draft_v1';
      const toast=document.getElementById('autosaveToast');
      const form = document.getElementById('candForm');
      const saveDraft = () => {
        const data = new FormData(form);
        localStorage.setItem(STORE_KEY, JSON.stringify(Object.fromEntries(data)));
      };
      const loadDraft = () => {
        const raw = localStorage.getItem(STORE_KEY);
        if(!raw) return;
        try{
          const obj = JSON.parse(raw);
          for(const [k,v] of Object.entries(obj)){
            const el = form.querySelector(`[name="${k}"]`);
            if(!el) continue;
            if(el.type==='file') continue;
            el.value = v;
          }
          // restore tags
          if(obj.skills){
            tags = obj.skills.split(',').map(s=>s.trim()).filter(Boolean);
            renderTags(); syncHidden();
          }
          // restore RTW
          if(obj.right_to_work){
            const set = new Set(obj.right_to_work.split(',').map(s=>s.trim()));
            document.querySelectorAll('#rtwGroup input[type="checkbox"]').forEach(cb=>{
              cb.checked = set.has(cb.value);
            });
          }
          document.getElementById('rtwHidden').value = getRTW().join(', ');
          refresh();
          toast.textContent='Draft restored ✔'; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),1600);
        }catch{}
      };
      loadDraft();
      form.addEventListener('input', saveDraft);
      form.addEventListener('change', saveDraft);

      // Capture page URL + guards
      const pageUrlHidden = document.getElementById('pageUrlHidden');
      const submitBtn = document.getElementById('submitBtn');
      form.addEventListener('submit', (e) => {
        pageUrlHidden.value = window.location.href;
        if(!getRTW().length){
          e.preventDefault(); alert('Please select at least one region for Right to Work.'); return;
        }
        const file = document.getElementById('cv').files?.[0];
        if(file && file.size > 6 * 1024 * 1024){
          e.preventDefault(); alert('Please upload a CV smaller than 6 MB.'); return;
        }
        submitBtn.disabled = true; submitBtn.textContent = 'Sending…';
        setTimeout(()=>localStorage.removeItem(STORE_KEY), 500);
      });
    })();
  </script>
</body>
</html>
