<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin Portal | HMJ-Global</title>
<link rel="stylesheet" href="/css/style.css" />
<style>
  :root{ --bg:#0b0b18; --panel:#14122a; --border:#26234b; --text:#e9e7ff; --muted:#a6a1d4; --accent:#7b5cff; --accent-2:#b6a6ff; }
  body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{max-width:1100px;margin:28px auto;padding:0 16px}
  .card{background:linear-gradient(180deg,#181642,#131130);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:16px}
  .muted{color:var(--muted)} .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .btn{background:#211d56;border:1px solid #342f6b;color:#fff;padding:14px 16px;border-radius:14px;font-weight:800;cursor:pointer}
  .btn:hover{border-color:#4b4592}
  .grid{display:grid;grid-template-columns:repeat(2,minmax(240px,1fr));gap:16px}
  @media (max-width:780px){ .grid{grid-template-columns:1fr} }
  .tile{display:block;background:#17143a;border:1px solid #2b2761;border-radius:16px;padding:18px;text-decoration:none;color:#fff}
  .tile h3{margin:0 0 6px}
</style>
<script defer src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="card row" style="justify-content:space-between">
      <div>
        <h1 style="margin:0 0 6px">HMJ Global — Admin Portal</h1>
        <div class="muted">Create & manage candidates, assignments, clients, and review the audit trail.</div>
      </div>
      <div class="row">
        <a class="btn" href="/">⟵ Homepage</a>
        <a class="btn" href="/timesheets.html">Timesheets</a>
        <button class="btn" onclick="netlifyIdentity?.logout()">Sign out</button>
      </div>
    </div>

    <div id="gate" class="card" style="display:none">
      <p><strong>Admin only.</strong> Please log in with an admin account.</p>
      <button class="btn" onclick="netlifyIdentity?.open('login')">Log in</button>
      <div class="muted">Ask an administrator to add the <code>admin</code> role to your user.</div>
    </div>

    <div id="app" style="display:none">
      <div class="grid">
        <a class="tile" href="/admin/timesheets.html"><h3>Timesheets</h3><div class="muted">Approve, edit, export, audit.</div></a>
        <a class="tile" href="/admin/candidates.html"><h3>Candidates</h3><div class="muted">Create profiles, bank & RTW info.</div></a>
        <a class="tile" href="/admin/assignments.html"><h3>Assignments</h3><div class="muted">Link candidates to clients/projects; rates & dates.</div></a>
        <a class="tile" href="/admin/clients.html"><h3>Clients</h3><div class="muted">Clients, sites & contacts.</div></a>
        <a class="tile" href="/admin/reports.html"><h3>Reports</h3><div class="muted">Audit log and CSVs.</div></a>
      </div>
    </div>
  </div>

<script>
  function isAdmin(u){ const r=u?.app_metadata?.roles||u?.roles||[]; return r.includes('admin'); }
  document.addEventListener('DOMContentLoaded', ()=>{
    netlifyIdentity?.on('init', ()=>{
      const u=netlifyIdentity?.currentUser(); if(u && isAdmin(u)){ document.getElementById('app').style.display='block'; } else { document.getElementById('gate').style.display='block'; }
    });
    netlifyIdentity?.on('login', ()=>location.reload());
    netlifyIdentity?.on('logout', ()=>location.href='/');
    setTimeout(()=>{ const u=netlifyIdentity?.currentUser(); if(u && isAdmin(u)) document.getElementById('app').style.display='block'; else document.getElementById('gate').style.display='block'; },600);
  });
</script>
</body>
</html>
