<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>HMJ Global — CMS Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Identity + CMS -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script src="https://unpkg.com/netlify-cms@^2/dist/netlify-cms.js"></script>

  <!-- HMJ Portal Styles -->
  <style>
    :root{
      --ink:#1A1A2E;             /* HMJ deep ink */
      --bg:#0f1322;              /* HMJ night blue */
      --accent:#3A66B3;          /* HMJ royal blue */
      --muted:#6b7280;
      --card:#ffffff;
      --border:rgba(26,26,46,.14);
      --ok:#1f7e39;
      --warn:#7a5b00;
      --chip:#eef3ff;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: Inter, Segoe UI, Roboto, Arial, sans-serif;
      background:linear-gradient(180deg, #0d1223, #0f1322 45%, #0f1322);
      color:#eaf0ff;
    }
    /* Top bar */
    .hmj-topbar{
      position:sticky; top:0; z-index:9999;
      background:linear-gradient(90deg, rgba(58,102,179,.12), rgba(58,102,179,.05));
      border-bottom:1px solid rgba(255,255,255,.08);
      backdrop-filter: blur(6px);
    }
    .hmj-topbar .inner{
      max-width:1200px; margin:0 auto; padding:12px 16px;
      display:flex; align-items:center; gap:12px; justify-content:space-between;
    }
    .hmj-brand{
      display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.3px;
      color:#eaf0ff;
    }
    .hmj-brand .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);display:inline-block}
    .hmj-actions{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .btn{
      display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px;
      text-decoration:none; font-weight:700; border:1px solid rgba(255,255,255,.14);
      transition:transform .15s ease, box-shadow .15s ease, background .15s ease;
      white-space:nowrap;
    }
    .btn:hover{transform:translateY(-1px); box-shadow:0 6px 18px rgba(0,0,0,.2)}
    .btn-blue{background:var(--accent); color:#fff; border-color:rgba(58,102,179,.8)}
    .btn-dark{background:#0f162c; color:#fff;}
    .btn-ghost{background:transparent; color:#eaf0ff;}

    /* Help / Hero panel */
    .hmj-hero{
      position:relative; overflow:hidden;
      border-bottom:1px solid rgba(255,255,255,.08);
      background:
        radial-gradient(1200px 400px at 20% -10%, rgba(58,102,179,.22), transparent 60%),
        radial-gradient(900px 400px at 80% 0%, rgba(58,102,179,.18), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.02), transparent);
    }
    .hmj-hero .inner{
      max-width:1200px; margin:0 auto; padding:28px 16px 8px;
      display:grid; grid-template-columns: 1.1fr .9fr; gap:18px;
    }
    .hero-card{
      background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08);
      border-radius:18px; padding:18px; color:#eaf0ff;
    }
    .hero-title{margin:0 0 8px 0; font-size:1.35rem; line-height:1.25}
    .hero-sub{margin:0 0 12px 0; color:#bfc9ff; font-weight:600}
    .hero-list{margin:0; padding:0 0 0 18px; line-height:1.45}
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size:.88rem; background:rgba(0,0,0,.4); color:#fff; padding:2px 6px; border-radius:6px; border:1px solid rgba(255,255,255,.12)
    }
    .note{
      display:inline-block; padding:4px 8px; border-radius:999px;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
      font-size:.8rem; color:#dce6ff; margin-top:2px
    }
    .chip{
      display:inline-block; padding:4px 10px; border-radius:999px; background:var(--chip);
      color:#1a2b55; font-weight:700; font-size:.78rem; border:1px solid rgba(58,102,179,.35)
    }

    /* CMS container shim (so CMS UI breathes) */
    .cms-frame{max-width:1200px; margin:12px auto 26px; padding:0 12px}
    .cms-help{
      display:flex; gap:12px; flex-wrap:wrap; margin:6px 0 0 0
    }
    .help-card{
      background:#0f162c; border:1px solid rgba(255,255,255,.12); color:#eaf0ff;
      padding:12px 14px; border-radius:14px; flex:1 1 260px
    }
    .help-card b{color:#fff}
    .help-card .small{color:#bcd0ff; font-size:.92rem}

    /* Make Netlify CMS panels feel branded */
    .nc-appHeader{background:#0f1322 !important; border-bottom:1px solid rgba(255,255,255,.08) !important}
    .nc-appHeader .nc-appHeader-main{color:#eaf0ff !important}
    .nc-collectionPage-header{background:linear-gradient(180deg, rgba(58,102,179,.08), rgba(255,255,255,0)) !important}
    .nc-toolbar{background:#0f1322 !important; border-top:1px solid rgba(255,255,255,.08) !important}
    .nc-button, .nc-collectionPage-sidebar-toggle{border-radius:12px !important}
    .nc-entryCard, .nc-widgetPreview, .nc-widgetControl, .nc-collectionPage-sidebar{
      border-radius:14px !important; border-color: rgba(26,26,46,.2) !important
    }
    .nc-entryListing-card{border-radius:16px !important}
    .nc-button{font-weight:700 !important}
    .nc-primary{background:var(--accent) !important; color:#fff !important; border:1px solid rgba(58,102,179,.9) !important}
    .nc-secondary{background:#101a36 !important; color:#fff !important}
    .nc-link{color:#cfe0ff !important}
    .nc-badge{border-radius:10px !important}

    /* Footer helper */
    .hmj-footer{max-width:1200px;margin:24px auto 36px;padding:0 16px;color:#bfc9ff}
    .hmj-footer a{color:#eaf0ff}
  </style>
</head>
<body>

  <!-- Top bar with Return to homepage -->
  <div class="hmj-topbar" role="navigation" aria-label="HMJ CMS Topbar">
    <div class="inner">
      <div class="hmj-brand">
        <span class="dot" aria-hidden="true"></span>
        HMJ Global — CMS Portal
      </div>
      <div class="hmj-actions">
        <a class="btn btn-blue" href="/" title="Go back to the live homepage">⟵ Return to Homepage</a>
        <a class="btn btn-dark" href="/jobs.html" title="Open public Jobs page in a new tab" target="_blank" rel="noopener">View Jobs Page</a>
        <a class="btn btn-ghost" href="https://app.netlify.com" target="_blank" rel="noopener" title="Open your Netlify dashboard">Netlify</a>
        <a class="btn btn-ghost" href="https://github.com" target="_blank" rel="noopener" title="Open GitHub">GitHub</a>
      </div>
    </div>
  </div>

  <!-- Friendly “How it works” help panel -->
  <section class="hmj-hero" role="region" aria-label="How to use the Jobs editor">
    <div class="inner">
      <div class="hero-card">
        <h1 class="hero-title">How to use the Jobs editor</h1>
        <p class="hero-sub">This portal writes to <span class="kbd">data/jobs.json</span>. Your public Jobs page reads that file to render cards, filters, and anchors.</p>
        <ol class="hero-list">
          <li>Open <b>Content → Jobs Data → Jobs</b>. Click a role to expand its fields.</li>
          <li>Fill in: <b>Title</b>, <b>Status</b>, <b>Section</b>, <b>Discipline</b>, <b>Employment Type</b>, <b>Location</b>, etc.</li>
          <li><b>ID (unique)</b> becomes the URL anchor: <span class="kbd">/jobs.html#your-id</span>. Keep it lowercase/kebab-case and don’t change it later.</li>
          <li>Click <b>Save</b>. In the <b>Workflow</b> panel move <span class="chip">Draft → In Review → Publish</span>.</li>
          <li>Image uploads go to <span class="kbd">images/uploads/</span>. (Use this folder for any role imagery.)</li>
        </ol>
        <p class="note">Tip: Test an anchor by opening <span class="kbd">/jobs.html#the-id-you-set</span> in a new tab. It should jump to the correct card.</p>
      </div>

      <div class="cms-help">
        <div class="help-card">
          <b>Status</b><br>
          <span class="small">Badge on the card & filter option. Choose <i>Live</i>, <i>Interviewing</i>, or <i>Closed</i>.</span>
        </div>
        <div class="help-card">
          <b>Section (Board)</b><br>
          <span class="small">Which board/column the role sits in (e.g., Data Centre, Pharma, Substations).</span>
        </div>
        <div class="help-card">
          <b>Location Code vs Text</b><br>
          <span class="small"><i>Code</i> drives filters; <i>Text</i> is what candidates see (e.g., “Frankfurt, Germany”).</span>
        </div>
        <div class="help-card">
          <b>Apply URL (optional)</b><br>
          <span class="small">Leave blank to use the default HMJ apply flow. Add a full link to send candidates to a client ATS.</span>
        </div>
      </div>
    </div>
  </section>

  <!-- CMS mounts itself here -->
  <div class="cms-frame">
    <div id="nc-root"></div>
  </div>

  <div class="hmj-footer">
    Need help? Ping us: <a href="mailto:info@hmj-global.com">info@hmj-global.com</a>.  ·  Anchors look like <span class="kbd">/jobs.html#electrical-supervisor-uk</span>
  </div>

  <script>
    // Optional: redirect to the CMS entry list immediately after login.
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on('init', user => {
        if (!user) { window.netlifyIdentity.on('login', () => { window.location.reload(); }); }
      });
    }

    // Branded tweaks to the CMS (preview styles are minimal to avoid clashing with widget layout)
    CMS.registerPreviewStyle(`
      :root { --accent: #3A66B3; }
      a { color: var(--accent); }
    `, { raw: true });

    // ---- Netlify CMS Inline Config ----
    CMS.init({
      config: {
        backend: { name: "git-gateway", branch: "main" },
        media_folder: "images/uploads",
        public_folder: "/images/uploads",
        publish_mode: "editorial_workflow",

        collections: [
          {
            label: "Jobs Data",
            name: "jobsData",
            files: [
              {
                label: "Jobs",
                name: "jobsFile",
                file: "data/jobs.json",
                description: "This file powers the Jobs page (/jobs.html).",
                fields: [
                  {
                    label: "Jobs",
                    name: "jobs",
                    widget: "list",
                    collapsed: true,
                    summary: "{{fields.title}} — {{fields.locationText}} ({{fields.status}} | {{fields.section}} | {{fields.type}})",
                    fields: [
                      {
                        label: "ID (unique, used as URL anchor)",
                        name: "id",
                        widget: "string",
                        hint: "Becomes /jobs.html#your-id (e.g., mep-qs-dublin). Keep stable once published.",
                        pattern: ["^[a-z0-9-]+$", "Use lowercase letters, numbers, and hyphens only (e.g., mep-qs-dublin)"]
                      },
                      {
                        label: "Published",
                        name: "published",
                        widget: "boolean",
                        default: true,
                        hint: "Turn OFF to hide this role from the site."
                      },
                      {
                        label: "Title",
                        name: "title",
                        widget: "string",
                        hint: "Shown as the card heading (e.g., “Electrical Project Manager — Data Centre”)."
                      },
                      {
                        label: "Status (badge shown on card)",
                        name: "status",
                        widget: "select",
                        options: [
                          { label: "Live — Taking Candidates", value: "live" },
                          { label: "Interviewing — Shortlist in Review", value: "interviewing" },
                          { label: "Closed — Not Accepting New Applicants", value: "closed" }
                        ],
                        default: "live",
                        hint: "Also used by the Status filter on the Jobs page."
                      },
                      {
                        label: "Section (which board/column to show in)",
                        name: "section",
                        widget: "select",
                        options: [
                          { label: "Data Centre — Commercial", value: "commercial" },
                          { label: "Data Centre — Engineering & Management", value: "dc" },
                          { label: "Substations, Power & Energy", value: "substations" },
                          { label: "Life Sciences & Pharma", value: "pharma" },
                          { label: "ICT & Commissioning", value: "ict" }
                        ],
                        default: "dc",
                        hint: "Matches the big section headings on the Jobs page."
                      },
                      {
                        label: "Discipline (shown as a tag)",
                        name: "discipline",
                        widget: "select",
                        options: ["Data Centre","Life Sciences","Pharma","Substation"],
                        default: "Data Centre",
                        hint: "Appears as the blue tag on each card and powers the Discipline filter."
                      },
                      {
                        label: "Employment Type (filter chip)",
                        name: "type",
                        widget: "select",
                        options: [
                          { label: "Permanent", value: "permanent" },
                          { label: "Contract", value: "contract" }
                        ],
                        default: "permanent",
                        hint: "Used by the Employment filter on the Jobs page."
                      },
                      {
                        label: "Location Code (drives the Location filter)",
                        name: "locationCode",
                        widget: "select",
                        options: [
                          { label: "Amsterdam, Netherlands", value: "amsterdam" },
                          { label: "Dublin, Ireland", value: "dublin" },
                          { label: "Eemshaven, Netherlands", value: "eemshaven" },
                          { label: "Espoo, Finland", value: "espoo" },
                          { label: "Frankfurt, Germany", value: "frankfurt" },
                          { label: "Groningen, Netherlands", value: "groningen" },
                          { label: "Helsinki, Finland", value: "helsinki" },
                          { label: "London, UK", value: "london" },
                          { label: "Macclesfield, UK", value: "macclesfield" },
                          { label: "UK (Various)", value: "uk" },
                          { label: "Europe (Travel)", value: "europe" }
                        ],
                        default: "uk",
                        hint: "Must match the site Location filter codes so filtering works."
                      },
                      {
                        label: "Location Text (what candidates see)",
                        name: "locationText",
                        widget: "string",
                        hint: "Human-friendly place shown on the card (e.g., “Frankfurt, Germany”)."
                      },
                      {
                        label: "Keywords (searchable)",
                        name: "keywords",
                        widget: "text",
                        required: false,
                        hint: "Comma/space-separated skills or terms to improve on-page search (e.g., “P6, commissioning, NEC”)."
                      },
                      {
                        label: "Overview",
                        name: "overview",
                        widget: "text",
                        required: false,
                        hint: "2–4 lines introducing the role."
                      },
                      {
                        label: "Responsibilities",
                        name: "responsibilities",
                        widget: "list",
                        required: false,
                        field: { label: "Item", name: "item", widget: "string" },
                        hint: "Bulleted list. Leave empty to hide."
                      },
                      {
                        label: "Requirements",
                        name: "requirements",
                        widget: "list",
                        required: false,
                        field: { label: "Item", name: "item", widget: "string" },
                        hint: "Bulleted list. Leave empty to hide."
                      },
                      {
                        label: "Apply URL (optional)",
                        name: "applyUrl",
                        widget: "string",
                        required: false,
                        hint: "Leave blank to use the default HMJ apply flow. Add a full URL to send candidates to an external ATS."
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    });

    // Optional guardrail: gentle warning if Title is blank when Published
    CMS.registerEventListener({
      name: 'preSave',
      handler: ({ entry }) => {
        try{
          const jobs = entry.getIn(['data','jobs']);
          if (!jobs) return;
          jobs.forEach((j, idx) => {
            const published = j && j.get('published');
            const title = j && (j.get('title')||'').trim();
            const id = j && (j.get('id')||'').trim();
            if (published && (!title || !id)){
              alert(`Job #${idx+1}: Please set both Title and ID before publishing.`);
              throw new Error('Missing required fields for published item');
            }
          });
        }catch(e){
          // Throwing stops the save; the alert explains why.
          throw e;
        }
      }
    });
  </script>
</body>
</html>
